// Generated by CoffeeScript 1.6.2
var ModalLogic,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ModalLogic = (function() {
  function ModalLogic() {
    this.renderTemplate = __bind(this.renderTemplate, this);
    this.showModal = __bind(this.showModal, this);
    this.createOrUpdateModalContent = __bind(this.createOrUpdateModalContent, this);
    var that;

    that = this;
    $('a[data-remote][modal],form[data-remote][modal]').live('ajax:complete', function(jq_event, xhr) {
      var response;

      response = JSON.parse(xhr.responseText);
      if (response.close != null) {
        if (response.redirect_location != null) {
          return window.location = response.redirect_location;
        } else {
          return window.location = window.location;
        }
      } else if (response.html == null) {
        return that.createOrUpdateModalContent({
          title: 'Error',
          html: 'There was an error.  Please reload the page and try again'
        });
      } else {
        return that.createOrUpdateModalContent(response);
      }
    });
  }

  ModalLogic.prototype.createOrUpdateModalContent = function(context) {
    var html, modal;

    modal = $('.modal.modal-logic');
    if (modal.length === 0) {
      html = this.renderTemplate({
        title: context.title,
        body: context.html
      });
      $('body').append(html);
    } else {
      modal.find('.modal-body').empty().append(context.html);
      modal.find('.modal-header > .modal-title').empty().append(context.title);
    }
    return this.showModal();
  };

  ModalLogic.prototype.showModal = function() {
    return $('.modal.modal-logic').modal('show');
  };

  ModalLogic.prototype.renderTemplate = function(context) {
    return "<div class=\"modal modal-logic hide fade\">\n  <div class=\"modal-header\">\n    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">Ã—</button>\n    <h3 class='modal-title'>" + context.title + "</h3>\n  </div>\n  <div class=\"modal-body\">\n    " + context.body + "\n  </div>\n</div>";
  };

  return ModalLogic;

})();
